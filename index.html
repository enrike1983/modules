<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor Aree & Moduli</title>
<style>
  body { font-family: sans-serif; max-width: 700px; margin: 2rem auto; }
  .area {
    border: 2px solid #333;
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    background: #fafafa;
    position: relative;
  }
  .area-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    margin-bottom: 1rem;
  }
  .area .module {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1rem;
    background: #f9f9f9;
    cursor: grab;
    position: relative;
  }
  .area .module:active { cursor: grabbing; }
  .delete-btn {
    position: absolute;
    top: 6px;
    right: 6px;
    background: #ff6666;
    border: none;
    color: white;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    cursor: pointer;
    font-weight: bold;
  }
  .add-btn {
    display: block;
    width: 100%;
    padding: 0.5rem;
    background: #eee;
    border: 1px dashed #aaa;
    border-radius: 8px;
    cursor: pointer;
    margin-bottom: 1rem;
  }
  textarea {
    width: 100%;
    min-height: 60px;
  }
  dialog {
    border: none;
    border-radius: 10px;
    padding: 1rem;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  dialog button { margin: 0.5rem; }
  #saveBtn {
    display: block;
    margin: 1rem auto;
    padding: 0.5rem 1rem;
  }
  pre { background: #f4f4f4; padding: 1rem; border-radius: 8px; }
</style>
</head>
<body>

<h1>Editor Aree e Moduli</h1>

<div id="areasContainer"></div>
<button id="addAreaBtn" class="add-btn">+ Aggiungi Area</button>

<button id="saveBtn">ðŸ’¾ Salva struttura</button>
<pre id="output"></pre>

<!-- Dialog per scegliere tipo modulo -->
<dialog id="moduleDialog">
  <h3>Seleziona tipo di modulo</h3>
  <button data-type="text">Testo</button>
  <button data-type="quote">Citazione</button>
  <button data-type="image">Immagine</button>
  <button id="closeDialog">Annulla</button>
</dialog>

<!-- SortableJS -->
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>

<script>
const areasContainer = document.getElementById('areasContainer');
const dialog = document.getElementById('moduleDialog');
const output = document.getElementById('output');
let currentArea = null;
let currentAddIndex = null;

// --- AREA ---
function createArea(title = 'Nuova Area') {
  const area = document.createElement('div');
  area.className = 'area';

  const header = document.createElement('div');
  header.className = 'area-header';

  const titleInput = document.createElement('input');
  titleInput.type = 'text';
  titleInput.value = title;
  titleInput.style.flex = '1';
  titleInput.style.marginRight = '1rem';

  const delBtn = document.createElement('button');
  delBtn.textContent = 'Ã—';
  delBtn.className = 'delete-btn';
  delBtn.title = 'Elimina area';
  delBtn.onclick = () => {
    area.remove();
    initAreasSortable();
  };

  header.appendChild(titleInput);
  header.appendChild(delBtn);
  area.appendChild(header);

  const modulesContainer = document.createElement('div');
  modulesContainer.className = 'modulesContainer';
  area.appendChild(modulesContainer);

  const addModuleBtn = document.createElement('button');
  addModuleBtn.textContent = '+ Aggiungi modulo';
  addModuleBtn.className = 'add-btn';
  addModuleBtn.onclick = () => {
    currentArea = area;
    currentAddIndex = getModules(area).length;
    dialog.showModal();
  };
  area.appendChild(addModuleBtn);

  initModulesSortable(modulesContainer);
  return area;
}

// --- MODULO ---
function createModule(type, content = '') {
  const module = document.createElement('div');
  module.className = 'module';
  module.dataset.type = type;

  const delBtn = document.createElement('button');
  delBtn.textContent = 'Ã—';
  delBtn.className = 'delete-btn';
  delBtn.title = 'Elimina modulo';
  delBtn.onclick = () => {
    module.remove();
  };
  module.appendChild(delBtn);

  if (type === 'text' || type === 'quote') {
    const textarea = document.createElement('textarea');
    textarea.placeholder = type === 'text' ? 'Scrivi del testo...' : 'Scrivi una citazione...';
    textarea.value = content;
    module.appendChild(textarea);
  } else if (type === 'image') {
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = 'URL immagine...';
    input.value = content;
    module.appendChild(input);
  }

  return module;
}

// --- UTILITY ---
function getAreas() {
  return Array.from(document.querySelectorAll('.area'));
}

function getModules(area) {
  return Array.from(area.querySelectorAll('.module'));
}

// --- DRAG&DROP ---
function initAreasSortable() {
  Sortable.create(areasContainer, {
    animation: 150,
    handle: '.area-header',
  });
}

function initModulesSortable(container) {
  Sortable.create(container, {
    animation: 150,
    handle: '.module',
  });
}

// --- SALVATAGGIO JSON ---
function toJSON() {
  return getAreas().map(area => {
    const title = area.querySelector('.area-header input').value;
    const modules = getModules(area).map(mod => {
      const type = mod.dataset.type;
      const input = mod.querySelector('textarea, input');
      return { type, content: input ? input.value : '' };
    });
    return { area: title, modules };
  });
}

// --- DIALOG MODULI ---
dialog.querySelectorAll('button[data-type]').forEach(btn => {
  btn.onclick = () => {
    const mod = createModule(btn.dataset.type);
    const modulesContainer = currentArea.querySelector('.modulesContainer');
    modulesContainer.appendChild(mod);
    initModulesSortable(modulesContainer);
    dialog.close();
  };
});
document.getElementById('closeDialog').onclick = () => dialog.close();

// --- EVENTI PRINCIPALI ---
document.getElementById('addAreaBtn').onclick = () => {
  const area = createArea();
  areasContainer.appendChild(area);
  initAreasSortable();
};

document.getElementById('saveBtn').onclick = () => {
  output.textContent = JSON.stringify(toJSON(), null, 2);
};

// --- INIT ---
initAreasSortable();
</script>

</body>
</html>

