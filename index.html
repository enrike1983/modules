<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestione Aree e Moduli</title>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      background: #f5f5f5;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .areas-container {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .area {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .area-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .area-header .left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .drag-handle {
      cursor: grab;
      font-size: 1.2rem;
      user-select: none;
    }
    .drag-handle:active { cursor: grabbing; }

    .area-title {
      border: none;
      border-bottom: 1px solid #ccc;
      font-size: 1rem;
      outline: none;
    }

    .modules-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .module {
      background: #fafafa;
      border: 1px solid #ddd;
      padding: 8px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .module input {
      border: none;
      background: transparent;
      flex: 1;
      margin-right: 10px;
      outline: none;
    }

    .add-btn, .delete-btn {
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 6px 10px;
      transition: background 0.2s;
    }

    .add-btn {
      background: #007bff;
      color: white;
    }
    .add-btn:hover { background: #0056b3; }

    .delete-btn {
      background: #dc3545;
      color: white;
    }
    .delete-btn:hover { background: #b02a37; }

    .save-btn {
      display: block;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 1rem;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .save-btn:hover { background: #218838; }

    /* Overlay per la selezione moduli */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .overlay.active {
      visibility: visible;
      opacity: 1;
    }

    .overlay-content {
      background: white;
      border-radius: 10px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
      text-align: center;
    }

    .overlay h3 { margin-top: 0; }

    .module-option {
      background: #007bff;
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin: 10px 0;
      cursor: pointer;
      transition: background 0.2s;
    }
    .module-option:hover { background: #0056b3; }

    @media (max-width: 600px) {
      body { padding: 10px; }
      .area { padding: 8px; }
      .area-header { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>

  <h1>Gestione Aree e Moduli</h1>
  <div class="areas-container" id="areasContainer"></div>
  <button class="add-btn" id="addAreaBtn">+ Area</button>
  <button class="save-btn" id="saveBtn">üíæ Salva struttura</button>

  <!-- Overlay per selezione moduli -->
  <div class="overlay" id="moduleOverlay">
    <div class="overlay-content">
      <h3>Seleziona un tipo di modulo</h3>
      <div class="module-option" data-type="testo">Modulo di testo</div>
      <div class="module-option" data-type="immagine">Modulo immagine</div>
      <div class="module-option" data-type="video">Modulo video</div>
      <button class="delete-btn" id="closeOverlay">Annulla</button>
    </div>
  </div>

  <script>
    const areasContainer = document.getElementById('areasContainer');
    const addAreaBtn = document.getElementById('addAreaBtn');
    const saveBtn = document.getElementById('saveBtn');
    const moduleOverlay = document.getElementById('moduleOverlay');
    const closeOverlay = document.getElementById('closeOverlay');
    let currentModulesContainer = null;

    addAreaBtn.addEventListener('click', () => addArea());
    saveBtn.addEventListener('click', saveStructure);
    closeOverlay.addEventListener('click', () => moduleOverlay.classList.remove('active'));

    function addArea(title = "Nuova area") {
      const area = document.createElement('div');
      area.className = 'area';
      area.innerHTML = `
        <div class="area-header">
          <div class="left">
            <span class="drag-handle">‚ò∞</span>
            <input type="text" class="area-title" value="${title}" placeholder="Nome area..." />
          </div>
          <div class="right">
            <button class="add-btn add-module-btn">+ Modulo</button>
            <button class="delete-btn delete-area-btn">üóëÔ∏è</button>
          </div>
        </div>
        <div class="modules-container"></div>
      `;
      areasContainer.appendChild(area);

      const modulesContainer = area.querySelector('.modules-container');
      const addModuleBtn = area.querySelector('.add-module-btn');
      const deleteAreaBtn = area.querySelector('.delete-area-btn');

      addModuleBtn.addEventListener('click', () => {
        currentModulesContainer = modulesContainer;
        moduleOverlay.classList.add('active');
      });

      deleteAreaBtn.addEventListener('click', () => area.remove());

      new Sortable(modulesContainer, {
        animation: 100,
        handle: '.drag-handle',
        ghostClass: 'dragging'
      });
    }

    document.querySelectorAll('.module-option').forEach(option => {
      option.addEventListener('click', () => {
        const type = option.dataset.type;
        addModule(type);
        moduleOverlay.classList.remove('active');
      });
    });

    function addModule(type = "testo", value = "") {
      if (!currentModulesContainer) return;
      const module = document.createElement('div');
      module.className = 'module';
      module.innerHTML = `
        <input type="text" placeholder="Contenuto del modulo ${type}..." value="${value}">
        <button class="delete-btn">üóëÔ∏è</button>
      `;
      const delBtn = module.querySelector('.delete-btn');
      delBtn.addEventListener('click', () => module.remove());
      currentModulesContainer.appendChild(module);
    }

    new Sortable(areasContainer, {
      animation: 100,
      handle: '.drag-handle',
      ghostClass: 'dragging'
    });

    function saveStructure() {
      const structure = [];
      document.querySelectorAll('.area').forEach(area => {
        const areaData = {
          title: area.querySelector('.area-title').value,
          modules: []
        };
        area.querySelectorAll('.module').forEach(module => {
          const input = module.querySelector('input');
          areaData.modules.push({
            type: "testo", // semplificato, puoi salvarlo meglio se vuoi
            content: input.value
          });
        });
        structure.push(areaData);
      });
      alert(JSON.stringify(structure, null, 2));
    }
  </script>
</body>
</html>

